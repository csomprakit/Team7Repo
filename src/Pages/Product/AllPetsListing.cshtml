@page
@model ContosoCrafts.WebSite.Pages.Product.AllPetsListingModel
@{
    ViewData["Title"] = "Pet Adoption";
}

<!--Uses user query to search for either a breed or a cost that a user asks for-->
@{
    string searchQuery = Request.Query["search"];
    string searchBy = Request.Query["searchBy"];

    var filteredPets = Model.Pets;

    if (!string.IsNullOrEmpty(searchQuery))
    {
        if (searchBy == "cost") 
        {
            filteredPets = filteredPets.Where(pet => pet.Cost.ToString().Contains(searchQuery)).ToList();
        }
        else // searchBy == "breed" or default
        {
            filteredPets = filteredPets.Where(pet => pet.Breed.ToLower().Contains(searchQuery.ToLower())).ToList();
        }
    }
}

<!DOCTYPE html>

<html>
    <head>
        <style>
            table {
                width: 100%
            }
            td, th {
                padding: 8px;
            }
        </style>
    </head>
<header>
    <h1>All available pets:</h1>
</header>
<!--Button to create a new pet-->
<div class="container">
    <a asp-page="Create" class="btn btn-link">Click here to add an adoptable pet to our website</a>
</div>

<!-- Search form to filter pets based on breed and cost, which does the search based on the searchInput function above, through a dropdown menu format.-->
<form method="get">
    <label for="searchInput">Search:</label>
    <input type="text" id="searchInput" name="search" value="@searchQuery">
    <label for="searchBySelect">Search by:</label>
    <select id="searchBySelect" name="searchBy">
        <option value="breed" selected>Breed</option>
        <option value="cost">Cost</option>
    </select>
    <button type="submit">Search</button>
</form>

<!--Table of available pets-->
<table>
    <thead>
        <tr>
            <th>Name</th>
            <th>Breed</th>
            <th>Location</th>
            <th>Action</th>
        </tr>
    </thead>
    <tbody>
        <!--Headers and information, will display pets of the breed requested or all pets-->
        @foreach (var pet in filteredPets)
        {
            <tr>
                <td>@Html.DisplayFor(modelItem => @pet.Name)</td>
                <td>@Html.DisplayFor(modelItem => @pet.Breed)</td>
                <td>@Html.DisplayFor(modelItem => @pet.Location)</td>
                <!--Link to pet information page when it is clicked-->
                <td><a asp-page="PetInformation" asp-route-id="@pet.Id">Read</a></td>
                <!--Link to update pet information page when it is clicked-->
                <td><a asp-page="Update" asp-route-id="@pet.Id">Update</a></td>
            </tr>
        }
       
    </tbody>
</table>
</html>


